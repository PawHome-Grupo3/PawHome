<!DOCTYPE html>
<html lang="es" xmlns:layout="https://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout.html}" xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="#{page.tienda.title}"></title>
  <link rel="stylesheet" th:href="@{/css/general.css}"/>
</head>
<body style="background-color: #f4faf8;">

<section layout:fragment="content">
  <div th:replace="~{fragments/navTienda :: navTiendaFragment}"></div>

  <!-- Tarjetas -->
  <section th:each="categoria : ${categorias}" class="section-padding pb-0" th:id="${categoriasNavDto.get(categoria.getId()-1).getNombre()}">
    <div class="container">
      <div class="row contCardsTienda justify-content-center">

        <div class="col-lg-12 col-12 text-center">
          <h2 class="w-auto tituloTienda m-0" th:utext="${categoriasDtos.get(categoria.getId()-1).getNombre()}"></h2>
        </div>

        <div th:each="producto : ${categoria.getProductos()}" class="col-lg-4 col-md-6 col-12 mb-4 mb-lg-0" >
          <div class="custom-block-wrap">
            <img th:src="${producto.getRutaImagen1()}" class="custom-block-image img-fluid" th:alt="'imagen de prducto ' + ${producto.nombre}">

            <div class="custom-block">
              <div class="custom-block-body py-0">
                <h5 class="mb-3" style="color:#5bc1ac; font-weight: 600;" th:utext="${producto.getNombre()}"></h5>

                <p style="color:#717275; font-weight: 300; font-size: 16px;" th:utext="${producto.getDescripcion()}"></p>
              </div>

              <div class="d-flex justify-content-center flex-row w-100 flex-nowrap align-items-stretch gap-1">
                <a th:href="@{/tienda/producto/{id}(id=${producto.getId()})}" class="custom-btn btn btnHazteVoluntario w-100 align-content-center" th:text="#{tienda.leerMas}"></a>

                <form th:if="${producto.getTallas().getFirst().getStock() > 1 && producto.getTallas().getFirst().getTallaje().equalsIgnoreCase('unica')}"
                      th:action="@{/tienda/carrito/agregar}" method="post" class="w-100">
                  <input type="hidden" name="productoId" th:value="${producto.getId()}" />
                  <input type="hidden" name="tallaId" th:value="${producto.getTallas().getFirst().getId()}" />
                  <input type="hidden" name="cantidad" value="1" />
<!--                  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
                  <button type="submit" class="custom-btn btn btnHazteVoluntario w-100 align-content-center" th:text="#{tienda.comprar}"></button>
                </form>

                <div th:unless="${producto.getTallas().getFirst().getTallaje().equalsIgnoreCase('unica')}" class="dropdown w-100 align-content-center justify-content-center">
                  <button class="custom-btn btn btnHazteVoluntario w-100 align-content-center"
                          type="button" id="tallaDropdown" data-bs-toggle="dropdown" aria-expanded="false" th:text="#{tienda.escogeTalla}"></button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="tallaDropdown">
                    <li th:each="talla : ${producto.getTallas()}" th:if="${talla.getStock() > 0}">
                      <form th:action="@{/tienda/carrito/agregar}" method="post">
                        <input type="hidden" name="productoId" th:value="${producto.getId()}" />
                        <input type="hidden" name="tallaId" th:value="${talla.id}" />
                        <input type="hidden" name="cantidad" value="1" />
<!--                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
                        <button type="submit" href="/tienda/carrito" class="text-center w-100" style="all: unset;">
                          <a class="dropdown-item" th:utext="${talla.getTallaje()}"></a>
                        </button>
                      </form>
                    </li>
                  </ul>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
</section>
</body>
</html>